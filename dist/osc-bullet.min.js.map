{"version":3,"file":"osc-bullet.min.js","sources":["../src/main.js"],"sourcesContent":["import $ from \"jquery\";\n\nimport './style.less';\n\n$.fn.bullet = function (options) {\n  options = $.extend({\n    content: '',     // 内容文字\n    avatar: '',      // 头像图片 URL (可选)\n    url: '',         // 链接 (可选)\n    color: '',       // 字体颜色 (可选)\n    bgColor: '',     // 背景颜色 (可选)\n    speed: 20,       // 动画时间(秒)\n    top: 0,          // 距离顶部位置(默认随机)\n    safeTop: 0,      // 顶部安全距离(范围内不显示)\n    safeBottom: 0,   // 底部安全距离(范围内不显示)\n    hasClose: true   // 开启关闭按钮\n  }, options);\n\n  const containerEl = $(this);\n  const containerWidth = containerEl.width();\n  const containerHeight = containerEl.height();\n\n  const availableWidth = window.innerWidth > containerWidth ? containerWidth : window.innerWidth;\n  const availableHeight = window.innerHeight > containerHeight ? containerHeight : window.innerHeight;\n\n  // check position\n  if (containerEl.css('position') === 'static') {\n    containerEl.css('position', 'relative');\n  }\n\n  // wrapper\n  const bulletId = 'bullet-' + Math.random().toString(36).substr(2, 6);\n  let bulletWrapperEl = null;\n  let _needRemoveBulletWrapperEl = $('.bullet-wrapper[data-remove=\"true\"]:eq(0)');\n  if (_needRemoveBulletWrapperEl && _needRemoveBulletWrapperEl.length > 0) {\n    _needRemoveBulletWrapperEl.removeAttr('data-remove');\n    _needRemoveBulletWrapperEl.removeAttr('style');\n    bulletWrapperEl = _needRemoveBulletWrapperEl;\n  } else {\n    bulletWrapperEl = $('<div class=\"bullet-wrapper\" id=\"' + bulletId + '\"></div>').appendTo(containerEl);\n  }\n\n  // inner\n  const bulletInnerEl = $('<div class=\"bullet-inner\"></div>');\n  bulletWrapperEl.append(bulletInnerEl);\n\n  let bulletInnerHTML = '';\n\n  // avatar\n  if (options.avatar) {\n    bulletInnerHTML += '<div class=\"bullet-avatar\"><img src=\"' + options.avatar + '\" alt=\"avatar\"></div>';\n  }\n\n  // content\n  bulletInnerHTML += '<div class=\"bullet-text\">';\n  bulletInnerHTML += options.url ? '<a href=\"' + options.url + '\" target=\"_blank\" >' + options.content + '</a>' : options.content;\n  bulletInnerHTML += '</div>';\n\n  // has close\n  if (options.hasClose) {\n    bulletWrapperEl.addClass('has-close');\n    bulletInnerHTML += '<div class=\"bullet-close\"></div>';\n  }\n\n  // render\n  bulletInnerEl.html(bulletInnerHTML);\n  if (options.color) {\n    bulletInnerEl.css('color', options.color);\n  }\n  if (options.bgColor) {\n    bulletInnerEl.css('background-color', options.bgColor);\n  }\n\n  // set top\n  const bulletHeight = bulletWrapperEl.height();\n  const maxTop = availableHeight - bulletHeight - options.safeBottom;\n  const minTop = options.safeTop;\n  const offsetTop = options.top || Math.floor(Math.random() * (maxTop - minTop) + minTop);\n  bulletWrapperEl.css('top', offsetTop + \"px\");\n\n  // insert keyframes\n  const bulletStyle = document.createElement('style');\n  document.head.appendChild(bulletStyle);\n  const keyframesFrom = 'from { transform: translate3d(' + availableWidth + 'px, 0, 0); }';\n  const keyframesTo = 'to { transform: translate3d(-100%, 0, 0); }';\n  bulletStyle.sheet.insertRule('@keyframes right-to-left { ' + keyframesFrom + keyframesTo + ' }', 0);\n\n  // set animation\n  bulletWrapperEl.css('visibility', 'visible');\n  bulletWrapperEl.css('animation-iteration-count', 1);\n  bulletWrapperEl.css('animation-delay', 0);\n  bulletWrapperEl.css('animation-direction', 'normal');\n  bulletWrapperEl.css('animation-timing-function', 'linear');\n  bulletWrapperEl.css('will-change', 'transform'); // optimize performance\n  bulletWrapperEl.css('animation-name', 'right-to-left');\n  bulletWrapperEl.css('animation-duration', options.speed + 's');\n\n  // start animation\n  bulletWrapperEl.css('animation-play-state', 'running');\n\n  const removeBulletWrapperEl = function () {\n    bulletWrapperEl.html('');\n    bulletWrapperEl.attr('data-remove', true);\n    bulletWrapperEl.css('opacity', '0');\n    bulletWrapperEl.css('visibility', 'hidden');\n  };\n\n  // listen animationend\n  bulletWrapperEl.on('animationend', removeBulletWrapperEl);\n\n  // handle click close\n  bulletWrapperEl.on('click', '.bullet-close', removeBulletWrapperEl);\n};\n\n$.fn.bullet.clear = function () {\n  $('.bullet-wrapper').remove();\n};\n"],"names":["fn","bullet","options","$","extend","content","avatar","url","color","bgColor","speed","top","safeTop","safeBottom","hasClose","containerEl","this","containerWidth","width","containerHeight","height","availableWidth","window","innerWidth","availableHeight","innerHeight","css","bulletId","Math","random","toString","substr","bulletWrapperEl","_needRemoveBulletWrapperEl","length","removeAttr","appendTo","bulletInnerEl","append","bulletInnerHTML","addClass","html","maxTop","minTop","offsetTop","floor","bulletStyle","document","createElement","head","appendChild","keyframesFrom","sheet","insertRule","removeBulletWrapperEl","attr","on","clear","remove"],"mappings":"yQAIEA,GAAGC,OAAS,SAAUC,GACtBA,EAAUC,EAAEC,OAAO,CACjBC,QAAS,GACTC,OAAQ,GACRC,IAAK,GACLC,MAAO,GACPC,QAAS,GACTC,MAAO,GACPC,IAAK,EACLC,QAAS,EACTC,WAAY,EACZC,UAAU,GACTZ,OAEGa,EAAcZ,EAAEa,MAChBC,EAAiBF,EAAYG,QAC7BC,EAAkBJ,EAAYK,SAE9BC,EAAiBC,OAAOC,WAAaN,EAAiBA,EAAiBK,OAAOC,WAC9EC,EAAkBF,OAAOG,YAAcN,EAAkBA,EAAkBG,OAAOG,YAGpD,WAAhCV,EAAYW,IAAI,aAClBX,EAAYW,IAAI,WAAY,gBAIxBC,EAAW,UAAYC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,GAC9DC,EAAkB,KAClBC,EAA6B9B,EAAE,6CAIjC6B,EAHEC,GAAkE,EAApCA,EAA2BC,QAC3DD,EAA2BE,WAAW,eACtCF,EAA2BE,WAAW,SACpBF,GAEA9B,EAAE,mCAAqCwB,EAAW,YAAYS,SAASrB,OAIrFsB,EAAgBlC,EAAE,oCACxB6B,EAAgBM,OAAOD,OAEnBE,EAAkB,GAGlBrC,EAAQI,SACViC,GAAmB,wCAA0CrC,EAAQI,OAAS,yBAIhFiC,GAAmB,4BACnBA,GAAmBrC,EAAQK,IAAM,YAAcL,EAAQK,IAAM,sBAAwBL,EAAQG,QAAU,OAASH,EAAQG,QACxHkC,GAAmB,SAGfrC,EAAQY,WACVkB,EAAgBQ,SAAS,aACzBD,GAAmB,oCAIrBF,EAAcI,KAAKF,GACfrC,EAAQM,OACV6B,EAAcX,IAAI,QAASxB,EAAQM,OAEjCN,EAAQO,SACV4B,EAAcX,IAAI,mBAAoBxB,EAAQO,aAK1CiC,EAASlB,EADMQ,EAAgBZ,SACWlB,EAAQW,WAClD8B,EAASzC,EAAQU,QACjBgC,EAAY1C,EAAQS,KAAOiB,KAAKiB,MAAMjB,KAAKC,UAAYa,EAASC,GAAUA,GAChFX,EAAgBN,IAAI,MAAOkB,EAAY,UAGjCE,EAAcC,SAASC,cAAc,SAC3CD,SAASE,KAAKC,YAAYJ,OACpBK,EAAgB,iCAAmC9B,EAAiB,eAE1EyB,EAAYM,MAAMC,WAAW,8BAAgCF,EADzC,gDAC6E,GAGjGnB,EAAgBN,IAAI,aAAc,WAClCM,EAAgBN,IAAI,4BAA6B,GACjDM,EAAgBN,IAAI,kBAAmB,GACvCM,EAAgBN,IAAI,sBAAuB,UAC3CM,EAAgBN,IAAI,4BAA6B,UACjDM,EAAgBN,IAAI,cAAe,aACnCM,EAAgBN,IAAI,iBAAkB,iBACtCM,EAAgBN,IAAI,qBAAsBxB,EAAQQ,MAAQ,KAG1DsB,EAAgBN,IAAI,uBAAwB,WAEd,SAAxB4B,IACJtB,EAAgBS,KAAK,IACrBT,EAAgBuB,KAAK,eAAe,GACpCvB,EAAgBN,IAAI,UAAW,KAC/BM,EAAgBN,IAAI,aAAc,UAIpCM,EAAgBwB,GAAG,eAAgBF,GAGnCtB,EAAgBwB,GAAG,QAAS,gBAAiBF,IAG/CnD,EAAEH,GAAGC,OAAOwD,MAAQ,WAClBtD,EAAE,mBAAmBuD"}